"0","grid <- expand.grid(SEX = c(""F"", ""M""), AGEGRP = unique(dt$AGEGRP))"
"0",""
"0","loess_fits <- lapply(1:nrow(grid), function(i){"
"0","  d <- dt[SEX == grid$SEX[i] & AGEGRP == grid$AGEGRP[i],]"
"0","  loess(POPULATION ~ YEAR, data = d, span = 0.5)"
"0","})"
"0",""
"0",""
"0","loess_yhat <- lapply(loess_fits, function(x){"
"0","  predict(x, newdata = data.frame(YEAR = seq(2005, 2020, 1/4)))"
"0","})"
"0",""
"0","grid <- expand.grid(YEAR = seq(2005, 2020, 1/4), "
"0","                    SEX = c(""F"", ""M""), "
"0","                    AGEGRP = unique(dt$AGEGRP))"
"0",""
"0","grid$POP_SMOOTH <- unlist(loess_yhat)"
"0","grid <- as.data.table(grid)"
"0",""
"0","dt <- merge(grid, dt, by=c(""YEAR"", ""SEX"", ""AGEGRP""), all.x = TRUE)"
